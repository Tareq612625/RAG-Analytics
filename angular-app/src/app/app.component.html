<div class="app-container">
  <nav class="main-nav">
    <div class="nav-left">
      <!-- Sidebar Toggle (only on chat route) -->
      @if (isOnChatRoute()) {
        <button class="nav-icon-btn" (click)="toggleSidebar()" title="Toggle sidebar">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
          </svg>
        </button>
      }
      <div class="nav-brand">
        <span>RAG Analytics</span>
      </div>
    </div>

    <!-- Status Badge (center, only on chat route) -->
    @if (isOnChatRoute()) {
      <div class="status-badge" [class.connected]="healthStatus?.status === 'healthy'">
        <span class="status-dot"></span>
        <span class="status-text">
          {{ healthStatus ? healthStatus.llm_provider + ' / ' + healthStatus.llm_model : 'Connecting...' }}
        </span>
      </div>
    }

    <div class="nav-right">
      <!-- Chat Actions (only on chat route) -->
      @if (isOnChatRoute()) {
        <button class="nav-icon-btn" (click)="toggleHelp()" title="Help">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <path d="M12 17h.01"></path>
          </svg>
        </button>
        <button class="nav-icon-btn" (click)="clearChat()" title="Clear chat">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          </svg>
        </button>
      }
      <div class="nav-links">
        <a routerLink="/chat" routerLinkActive="active">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          Chat
        </a>
        <a routerLink="/database" routerLinkActive="active">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
          </svg>
          Database
        </a>
      </div>
    </div>
  </nav>
  <main class="main-content">
    <router-outlet />
  </main>
</div>

<!-- Help Modal -->
@if (showHelpModal) {
  <div class="modal-overlay" (click)="toggleHelp()">
    <div class="help-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Analytics Assistant Help</h3>
        <button class="close-btn" (click)="toggleHelp()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
      <div class="modal-content">
        <p>Welcome to the Analytics Assistant! I can help you query your business data using natural language.</p>

        <h4>Try asking questions like:</h4>
        <ul>
          <li>"What is the total sales?"</li>
          <li>"Show me sales by region"</li>
          <li>"What are the top selling products?"</li>
          <li>"How many orders today?"</li>
          <li>"What is the total revenue this month?"</li>
        </ul>

        <h4>Tips:</h4>
        <ul>
          <li>Press <kbd>Enter</kbd> to send your message</li>
          <li>Press <kbd>Shift+Enter</kbd> for a new line</li>
          <li>Click "Show Details" to see the SQL query and raw data</li>
          <li>Use the sidebar to access your chat history</li>
        </ul>
      </div>
    </div>
  </div>
}
